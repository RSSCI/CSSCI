import json

with open("json/cssci-plus-extend.json", "r", encoding="utf-8") as f:
    data = json.load(f)

# https://navi.cnki.net/knavi/rss/GLSJ
xmlUrlBase = "https://navi.cnki.net/knavi/rss/"
# https://navi.cnki.net/knavi/journals/GLSJ/detail
htmlUrlBase = "https://navi.cnki.net/knavi/journals/"

subjectDict = {
    "综合性高校学报": "zonghe_gaoxiao",
    "高校社科学报": "gaoxiao_sheke",
    "综合性社会科学": "zonghe_shehui",
    "图书馆、情报与文献学": "tushu_qingbao",
    "政治学": "zhengzhi",
    "管理学": "guanli",
    "社会学": "shehui",
}

for subject in data:
    filename = subjectDict[subject] + ".opml"
    with open("opml/" + filename, "w", encoding="utf-8") as f:
        f.write(r'''<?xml version="1.0" encoding="UTF-8"?>''')
        f.write("\n")
        f.write(r'''<opml version="1.0">''')
        f.write("\n")
        f.write(" " * 2)
        f.write("<head>")
        f.write("\n")
        f.write(" " * 4)
        f.write("<title>" + filename + " generated by Zheng Shuai</title>")
        f.write("\n")
        f.write(" " * 2)
        f.write("</head>")
        f.write("\n")
        f.write(" " * 2)
        f.write("<body>")
        f.write("\n")
        f.write(" " * 4)
        f.write("<outline text=\"" + subject + "\" title=\"" + subject + "\">")

        for name, code in data[subject].items():
            xmlUrl = xmlUrlBase + code
            htmlUrl = htmlUrlBase + code + "/detail"
            f.write("\n")
            f.write(" " * 6)
            f.write("<outline text=\"" + name + "\" title=\"" + name + "\" type=\"rss\" xmlUrl=\"" + xmlUrl + "\" htmlUrl=\"" + htmlUrl + "\"/>")

        f.write("\n")
        f.write(" " * 4)
        f.write("</outline>")
        f.write("\n")
        f.write(" " * 2)
        f.write("</body>")
        f.write("\n")
        f.write("</opml>")
